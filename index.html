<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Расписание занятий</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    select, button { margin: 5px; padding: 10px 15px; cursor: pointer; }
    .hidden { display: none; }
    #output p { margin: 3px 0; }
    #output h4 { margin-top: 15px; }
  </style>
</head>
<body>
  <h2>Выбор группы</h2>
  <select id="groupSelect"></select>
  <button onclick="chooseGroup()">Выбрать</button>

  <div id="menu" class="hidden">
    <h2 id="groupTitle"></h2>
    <button onclick="showToday()">На сегодня</button>
    <button onclick="showTomorrow()">На завтра</button>
    <button onclick="showWeek()">На неделю</button>
    <button onclick="backToGroups()">Назад</button>
  </div>

  <div id="output"></div>

  <script>
    let schedule = {};
    let currentGroup = "";

    async function loadSchedule() {
      try {
        const res = await fetch("schedule.json");
        schedule = await res.json();

        const groupSelect = document.getElementById("groupSelect");
        groupSelect.innerHTML = ""; // очищаем перед заполнением

        const groups = Object.keys(schedule);
        if (groups.length === 0) {
          groupSelect.innerHTML = "<option>Группы не найдены</option>";
          return;
        }

        groups.forEach(group => {
          let option = document.createElement("option");
          option.value = group;
          option.textContent = group;
          groupSelect.appendChild(option);
        });
      } catch (e) {
        alert("Ошибка загрузки schedule.json");
        console.error(e);
      }
    }

    function chooseGroup() {
      currentGroup = document.getElementById("groupSelect").value;
      if (!currentGroup) {
        alert("Выберите группу!");
        return;
      }
      document.getElementById("menu").classList.remove("hidden");
      document.getElementById("groupTitle").textContent = "Группа " + currentGroup;
      document.getElementById("output").innerHTML = "";
    }

    function showDay(day) {
      let output = document.getElementById("output");
      output.innerHTML = "<h3>" + day + "</h3>";

      let lessons = schedule[currentGroup][day];
      if (!lessons || lessons.length === 0) {
        output.innerHTML += "<p>Занятий нет</p>";
        return;
      }

      lessons.forEach(l => {
        output.innerHTML += `<p><b>${l.time} урок</b>: ${l.lesson} (${l.teacher}) ${l.room ? "ауд. " + l.room : ""}</p>`;
      });
    }

    function showToday() {
      const daysRu = ["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"];
      let idx = new Date().getDay(); // 0 - Вск, 1 - Пн ...
      let today = daysRu[idx].toUpperCase();
      showDay(today);
    }

    function showTomorrow() {
      const daysRu = ["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"];
      let idx = new Date().getDay() + 1;
      if (idx > 6) idx = 1; // после воскресенья снова понедельник
      let tomorrow = daysRu[idx].toUpperCase();
      showDay(tomorrow);
    }

    function showWeek() {
      let output = document.getElementById("output");
      output.innerHTML = "<h3>Расписание на неделю</h3>";

      for (let day in schedule[currentGroup]) {
        output.innerHTML += `<h4>${day}</h4>`;
        schedule[currentGroup][day].forEach(l => {
          output.innerHTML += `<p><b>${l.time} урок</b>: ${l.lesson} (${l.teacher}) ${l.room ? "ауд. " + l.room : ""}</p>`;
        });
      }
    }

    function backToGroups() {
      document.getElementById("menu").classList.add("hidden");
      document.getElementById("output").innerHTML = "";
      document.getElementById("groupSelect").value = "";
    }

    // Загружаем расписание при старте
    loadSchedule();
  </script>
</body>
</html>
